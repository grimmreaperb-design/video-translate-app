<!DOCTYPE html>
<html>
<head>
    <title>Teste WebRTC Simples</title>
    <script src="/socket.io/socket.io.js"></script>
</head>
<body>
    <h1>Teste WebRTC - Dois UsuÃ¡rios</h1>
    <div id="logs"></div>
    
    <script>
        function log(message) {
            const logs = document.getElementById('logs');
            logs.innerHTML += `<div>${new Date().toLocaleTimeString()}: ${message}</div>`;
            console.log(message);
        }

        // Simular dois usuÃ¡rios - usando o frontend que tem proxy
        const socket1 = io('http://localhost:3002');
        const socket2 = io('http://localhost:3002');

        // UsuÃ¡rio 1 (Alice)
        socket1.on('connect', () => {
            log('ðŸŸ¢ Alice conectada');
            socket1.emit('join-room', {
                roomId: 'test-room-simple',
                user: { id: 'alice-123', name: 'Alice' }
            });
        });

        socket1.on('user-joined', (user) => {
            log(`ðŸ”¥ Alice recebeu user-joined: ${user.name} (${user.id})`);
        });

        socket1.on('webrtc-offer', (data) => {
            log(`ðŸ“ž Alice recebeu offer de ${data.from}`);
        });

        socket1.on('webrtc-answer', (data) => {
            log(`âœ… Alice recebeu answer de ${data.from}`);
        });

        // UsuÃ¡rio 2 (Bob) - conecta apÃ³s 2 segundos
        setTimeout(() => {
            socket2.on('connect', () => {
                log('ðŸŸ¢ Bob conectado');
                socket2.emit('join-room', {
                    roomId: 'test-room-simple',
                    user: { id: 'bob-456', name: 'Bob' }
                });
            });

            socket2.on('user-joined', (user) => {
                log(`ðŸ”¥ Bob recebeu user-joined: ${user.name} (${user.id})`);
            });

            socket2.on('webrtc-offer', (data) => {
                log(`ðŸ“ž Bob recebeu offer de ${data.from}`);
                // Simular resposta
                socket2.emit('webrtc-answer', {
                    to: data.from,
                    answer: { type: 'answer', sdp: 'fake-answer-sdp' }
                });
                log(`âœ… Bob enviou answer para ${data.from}`);
            });

            socket2.on('webrtc-answer', (data) => {
                log(`âœ… Bob recebeu answer de ${data.from}`);
            });
        }, 2000);

        // Simular criaÃ§Ã£o de oferta quando Alice recebe user-joined
        socket1.on('user-joined', (user) => {
            if (user.id === 'bob-456') {
                setTimeout(() => {
                    socket1.emit('webrtc-offer', {
                        to: user.id,
                        offer: { type: 'offer', sdp: 'fake-offer-sdp' }
                    });
                    log(`ðŸ“ž Alice enviou offer para ${user.id}`);
                }, 500);
            }
        });
    </script>
</body>
</html>