<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste - Mesma Sala</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .room-link {
            background: #e3f2fd;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            word-break: break-all;
        }
        .instructions {
            background: #fff3e0;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
        }
        button {
            background: #2196F3;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #1976D2;
        }
        .log-area {
            background: #f5f5f5;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Teste - Usu√°rios na Mesma Sala</h1>
        
        <div class="instructions">
            <h3>üìã Instru√ß√µes para Teste:</h3>
            <ol>
                <li><strong>Gere um ID de sala √∫nico</strong> clicando no bot√£o abaixo</li>
                <li><strong>Copie o link gerado</strong> e abra em <strong>duas abas/janelas diferentes</strong></li>
                <li><strong>Use nomes diferentes</strong> em cada aba (ex: "Usu√°rio A" e "Usu√°rio B")</li>
                <li><strong>Verifique se:</strong>
                    <ul>
                        <li>O n√∫mero de participantes mostra "2" em ambas as abas</li>
                        <li>Cada usu√°rio v√™ o v√≠deo do outro</li>
                        <li>Os logs no console mostram a conex√£o entre os usu√°rios</li>
                    </ul>
                </li>
            </ol>
        </div>

        <div class="test-section">
            <h3>üéØ Gerador de Sala de Teste</h3>
            <button onclick="generateTestRoom()">üé≤ Gerar Nova Sala de Teste</button>
            <button onclick="copyRoomLink()" id="copyBtn" style="display:none;">üìã Copiar Link</button>
            
            <div id="roomLinkContainer" style="display:none;">
                <h4>üîó Link da Sala Gerada:</h4>
                <div class="room-link" id="roomLink"></div>
                <p><strong>‚ö†Ô∏è Importante:</strong> Abra este link em <strong>duas abas/janelas diferentes</strong> para simular dois usu√°rios.</p>
            </div>
        </div>

        <div class="test-section">
            <h3>üìä Logs de Debug</h3>
            <button onclick="clearLogs()">üßπ Limpar Logs</button>
            <button onclick="openConsole()">üîç Abrir Console do Navegador</button>
            <div class="log-area" id="logArea">
                <div>Aguardando logs...</div>
            </div>
        </div>

        <div class="test-section">
            <h3>üîß Verifica√ß√µes Autom√°ticas</h3>
            <button onclick="runDiagnostics()">ü©∫ Executar Diagn√≥sticos</button>
            <div id="diagnosticsResult"></div>
        </div>
    </div>

    <script>
        let currentRoomId = null;
        
        function generateTestRoom() {
            // Gera um ID √∫nico para a sala de teste
            currentRoomId = 'test-' + Math.random().toString(36).substr(2, 9);
            
            const baseUrl = window.location.origin.replace('/test-same-room.html', '');
            const roomUrl = `${baseUrl}?roomId=${currentRoomId}`;
            
            document.getElementById('roomLink').textContent = roomUrl;
            document.getElementById('roomLinkContainer').style.display = 'block';
            document.getElementById('copyBtn').style.display = 'inline-block';
            
            addLog(`‚úÖ Sala de teste gerada: ${currentRoomId}`);
            addLog(`üîó URL: ${roomUrl}`);
            addLog(`üìù Pr√≥ximo passo: Copie o link e abra em duas abas diferentes`);
        }
        
        function copyRoomLink() {
            const roomLink = document.getElementById('roomLink').textContent;
            navigator.clipboard.writeText(roomLink).then(() => {
                addLog('üìã Link copiado para a √°rea de transfer√™ncia!');
                document.getElementById('copyBtn').textContent = '‚úÖ Copiado!';
                setTimeout(() => {
                    document.getElementById('copyBtn').textContent = 'üìã Copiar Link';
                }, 2000);
            }).catch(err => {
                addLog('‚ùå Erro ao copiar: ' + err);
                alert('Link: ' + roomLink);
            });
        }
        
        function addLog(message) {
            const logArea = document.getElementById('logArea');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.textContent = `[${timestamp}] ${message}`;
            logArea.appendChild(logEntry);
            logArea.scrollTop = logArea.scrollHeight;
        }
        
        function clearLogs() {
            document.getElementById('logArea').innerHTML = '<div>Logs limpos...</div>';
        }
        
        function openConsole() {
            addLog('üí° Dica: Pressione F12 ou Ctrl+Shift+I (Cmd+Option+I no Mac) para abrir o console');
            addLog('üîç No console, procure por logs que come√ßam com [TEST-LOG]');
        }
        
        function runDiagnostics() {
            const result = document.getElementById('diagnosticsResult');
            result.innerHTML = '<h4>ü©∫ Executando diagn√≥sticos...</h4>';
            
            const checks = [];
            
            // Verifica se est√° em HTTPS (necess√°rio para WebRTC)
            if (location.protocol === 'https:' || location.hostname === 'localhost') {
                checks.push('‚úÖ Protocolo seguro (HTTPS/localhost)');
            } else {
                checks.push('‚ùå Protocolo inseguro - WebRTC pode n√£o funcionar');
            }
            
            // Verifica suporte a WebRTC
            if (window.RTCPeerConnection) {
                checks.push('‚úÖ WebRTC suportado');
            } else {
                checks.push('‚ùå WebRTC n√£o suportado');
            }
            
            // Verifica suporte a getUserMedia
            if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
                checks.push('‚úÖ getUserMedia suportado');
            } else {
                checks.push('‚ùå getUserMedia n√£o suportado');
            }
            
            // Verifica se h√° sala gerada
            if (currentRoomId) {
                checks.push(`‚úÖ Sala de teste gerada: ${currentRoomId}`);
            } else {
                checks.push('‚ö†Ô∏è Nenhuma sala de teste gerada ainda');
            }
            
            result.innerHTML = '<h4>ü©∫ Resultados dos Diagn√≥sticos:</h4><ul>' + 
                checks.map(check => `<li>${check}</li>`).join('') + '</ul>';
            
            addLog('ü©∫ Diagn√≥sticos executados - veja os resultados acima');
        }
        
        // Log inicial
        addLog('üß™ P√°gina de teste carregada');
        addLog('üìù Clique em "Gerar Nova Sala de Teste" para come√ßar');
        
        // Intercepta logs do console para mostrar na p√°gina
        const originalLog = console.log;
        console.log = function(...args) {
            originalLog.apply(console, args);
            const message = args.join(' ');
            if (message.includes('[TEST-LOG]')) {
                addLog('üîç ' + message);
            }
        };
    </script>
</body>
</html>